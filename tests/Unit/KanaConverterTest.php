<?php

namespace Wttks\StrJa\Tests\Unit;

use PHPUnit\Framework\Attributes\DataProvider;
use PHPUnit\Framework\Attributes\Test;
use PHPUnit\Framework\TestCase;
use Wttks\StrJa\KanaConverter;

/**
 * KanaConverter の正確性テスト
 */
class KanaConverterTest extends TestCase
{
    // =========================================================================
    // toHiragana: 全角カタカナ → ひらがな（全文字）
    // =========================================================================

    #[Test]
    #[DataProvider('katakanaToHiraganaProvider')]
    public function 全角カタカナ1文字がひらがな1文字に変換される(string $kata, string $hira): void
    {
        $this->assertSame($hira, KanaConverter::toHiragana($kata));
    }

    public static function katakanaToHiraganaProvider(): array
    {
        return [
            // ア行
            'ア' => ['ア', 'あ'], 'イ' => ['イ', 'い'], 'ウ' => ['ウ', 'う'],
            'エ' => ['エ', 'え'], 'オ' => ['オ', 'お'],
            // カ行
            'カ' => ['カ', 'か'], 'キ' => ['キ', 'き'], 'ク' => ['ク', 'く'],
            'ケ' => ['ケ', 'け'], 'コ' => ['コ', 'こ'],
            // サ行
            'サ' => ['サ', 'さ'], 'シ' => ['シ', 'し'], 'ス' => ['ス', 'す'],
            'セ' => ['セ', 'せ'], 'ソ' => ['ソ', 'そ'],
            // タ行
            'タ' => ['タ', 'た'], 'チ' => ['チ', 'ち'], 'ツ' => ['ツ', 'つ'],
            'テ' => ['テ', 'て'], 'ト' => ['ト', 'と'],
            // ナ行
            'ナ' => ['ナ', 'な'], 'ニ' => ['ニ', 'に'], 'ヌ' => ['ヌ', 'ぬ'],
            'ネ' => ['ネ', 'ね'], 'ノ' => ['ノ', 'の'],
            // ハ行
            'ハ' => ['ハ', 'は'], 'ヒ' => ['ヒ', 'ひ'], 'フ' => ['フ', 'ふ'],
            'ヘ' => ['ヘ', 'へ'], 'ホ' => ['ホ', 'ほ'],
            // マ行
            'マ' => ['マ', 'ま'], 'ミ' => ['ミ', 'み'], 'ム' => ['ム', 'む'],
            'メ' => ['メ', 'め'], 'モ' => ['モ', 'も'],
            // ヤ行
            'ヤ' => ['ヤ', 'や'], 'ユ' => ['ユ', 'ゆ'], 'ヨ' => ['ヨ', 'よ'],
            // ラ行
            'ラ' => ['ラ', 'ら'], 'リ' => ['リ', 'り'], 'ル' => ['ル', 'る'],
            'レ' => ['レ', 'れ'], 'ロ' => ['ロ', 'ろ'],
            // ワ行
            'ワ' => ['ワ', 'わ'], 'ヲ' => ['ヲ', 'を'], 'ン' => ['ン', 'ん'],
            // 濁音（カ行）
            'ガ' => ['ガ', 'が'], 'ギ' => ['ギ', 'ぎ'], 'グ' => ['グ', 'ぐ'],
            'ゲ' => ['ゲ', 'げ'], 'ゴ' => ['ゴ', 'ご'],
            // 濁音（サ行）
            'ザ' => ['ザ', 'ざ'], 'ジ' => ['ジ', 'じ'], 'ズ' => ['ズ', 'ず'],
            'ゼ' => ['ゼ', 'ぜ'], 'ゾ' => ['ゾ', 'ぞ'],
            // 濁音（タ行）
            'ダ' => ['ダ', 'だ'], 'ヂ' => ['ヂ', 'ぢ'], 'ヅ' => ['ヅ', 'づ'],
            'デ' => ['デ', 'で'], 'ド' => ['ド', 'ど'],
            // 濁音（ハ行）
            'バ' => ['バ', 'ば'], 'ビ' => ['ビ', 'び'], 'ブ' => ['ブ', 'ぶ'],
            'ベ' => ['ベ', 'べ'], 'ボ' => ['ボ', 'ぼ'],
            // 半濁音
            'パ' => ['パ', 'ぱ'], 'ピ' => ['ピ', 'ぴ'], 'プ' => ['プ', 'ぷ'],
            'ペ' => ['ペ', 'ぺ'], 'ポ' => ['ポ', 'ぽ'],
            // 小文字
            'ァ' => ['ァ', 'ぁ'], 'ィ' => ['ィ', 'ぃ'], 'ゥ' => ['ゥ', 'ぅ'],
            'ェ' => ['ェ', 'ぇ'], 'ォ' => ['ォ', 'ぉ'],
            'ャ' => ['ャ', 'ゃ'], 'ュ' => ['ュ', 'ゅ'], 'ョ' => ['ョ', 'ょ'],
            'ッ' => ['ッ', 'っ'],
            // mb_convert_kana で変換されないため strtr で補完する文字
            'ヴ' => ['ヴ', 'ゔ'],
            'ヵ' => ['ヵ', 'ゕ'],
            'ヶ' => ['ヶ', 'ゖ'],
            // 長音は変換されない
            'ー' => ['ー', 'ー'],
        ];
    }

    // =========================================================================
    // toHiragana: 半角カナ → ひらがな（全文字）
    // =========================================================================

    #[Test]
    #[DataProvider('halfKanaToHiraganaProvider')]
    public function 半角カナ1文字がひらがな1文字に変換される(string $half, string $hira): void
    {
        $this->assertSame($hira, KanaConverter::toHiragana($half));
    }

    public static function halfKanaToHiraganaProvider(): array
    {
        return [
            'ｱ' => ['ｱ', 'あ'], 'ｲ' => ['ｲ', 'い'], 'ｳ' => ['ｳ', 'う'],
            'ｴ' => ['ｴ', 'え'], 'ｵ' => ['ｵ', 'お'],
            'ｶ' => ['ｶ', 'か'], 'ｷ' => ['ｷ', 'き'], 'ｸ' => ['ｸ', 'く'],
            'ｹ' => ['ｹ', 'け'], 'ｺ' => ['ｺ', 'こ'],
            'ｻ' => ['ｻ', 'さ'], 'ｼ' => ['ｼ', 'し'], 'ｽ' => ['ｽ', 'す'],
            'ｾ' => ['ｾ', 'せ'], 'ｿ' => ['ｿ', 'そ'],
            'ﾀ' => ['ﾀ', 'た'], 'ﾁ' => ['ﾁ', 'ち'], 'ﾂ' => ['ﾂ', 'つ'],
            'ﾃ' => ['ﾃ', 'て'], 'ﾄ' => ['ﾄ', 'と'],
            'ﾅ' => ['ﾅ', 'な'], 'ﾆ' => ['ﾆ', 'に'], 'ﾇ' => ['ﾇ', 'ぬ'],
            'ﾈ' => ['ﾈ', 'ね'], 'ﾉ' => ['ﾉ', 'の'],
            'ﾊ' => ['ﾊ', 'は'], 'ﾋ' => ['ﾋ', 'ひ'], 'ﾌ' => ['ﾌ', 'ふ'],
            'ﾍ' => ['ﾍ', 'へ'], 'ﾎ' => ['ﾎ', 'ほ'],
            'ﾏ' => ['ﾏ', 'ま'], 'ﾐ' => ['ﾐ', 'み'], 'ﾑ' => ['ﾑ', 'む'],
            'ﾒ' => ['ﾒ', 'め'], 'ﾓ' => ['ﾓ', 'も'],
            'ﾔ' => ['ﾔ', 'や'], 'ﾕ' => ['ﾕ', 'ゆ'], 'ﾖ' => ['ﾖ', 'よ'],
            'ﾗ' => ['ﾗ', 'ら'], 'ﾘ' => ['ﾘ', 'り'], 'ﾙ' => ['ﾙ', 'る'],
            'ﾚ' => ['ﾚ', 'れ'], 'ﾛ' => ['ﾛ', 'ろ'],
            'ﾜ' => ['ﾜ', 'わ'], 'ｦ' => ['ｦ', 'を'], 'ﾝ' => ['ﾝ', 'ん'],
            // 濁音（2文字 → 1文字）
            'ｶﾞ' => ['ｶﾞ', 'が'], 'ｷﾞ' => ['ｷﾞ', 'ぎ'], 'ｸﾞ' => ['ｸﾞ', 'ぐ'],
            'ｹﾞ' => ['ｹﾞ', 'げ'], 'ｺﾞ' => ['ｺﾞ', 'ご'],
            'ｻﾞ' => ['ｻﾞ', 'ざ'], 'ｼﾞ' => ['ｼﾞ', 'じ'], 'ｽﾞ' => ['ｽﾞ', 'ず'],
            'ｾﾞ' => ['ｾﾞ', 'ぜ'], 'ｿﾞ' => ['ｿﾞ', 'ぞ'],
            'ﾀﾞ' => ['ﾀﾞ', 'だ'], 'ﾁﾞ' => ['ﾁﾞ', 'ぢ'], 'ﾂﾞ' => ['ﾂﾞ', 'づ'],
            'ﾃﾞ' => ['ﾃﾞ', 'で'], 'ﾄﾞ' => ['ﾄﾞ', 'ど'],
            'ﾊﾞ' => ['ﾊﾞ', 'ば'], 'ﾋﾞ' => ['ﾋﾞ', 'び'], 'ﾌﾞ' => ['ﾌﾞ', 'ぶ'],
            'ﾍﾞ' => ['ﾍﾞ', 'べ'], 'ﾎﾞ' => ['ﾎﾞ', 'ぼ'],
            // 半濁音（2文字 → 1文字）
            'ﾊﾟ' => ['ﾊﾟ', 'ぱ'], 'ﾋﾟ' => ['ﾋﾟ', 'ぴ'], 'ﾌﾟ' => ['ﾌﾟ', 'ぷ'],
            'ﾍﾟ' => ['ﾍﾟ', 'ぺ'], 'ﾎﾟ' => ['ﾎﾟ', 'ぽ'],
            // 小文字
            'ｧ' => ['ｧ', 'ぁ'], 'ｨ' => ['ｨ', 'ぃ'], 'ｩ' => ['ｩ', 'ぅ'],
            'ｪ' => ['ｪ', 'ぇ'], 'ｫ' => ['ｫ', 'ぉ'],
            'ｬ' => ['ｬ', 'ゃ'], 'ｭ' => ['ｭ', 'ゅ'], 'ｮ' => ['ｮ', 'ょ'],
            'ｯ' => ['ｯ', 'っ'],
            // 長音は変換されない
            'ｰ' => ['ｰ', 'ー'],
        ];
    }

    // =========================================================================
    // toKatakana: ひらがな → 全角カタカナ（全文字）
    // =========================================================================

    #[Test]
    #[DataProvider('hiraganaToKatakanaProvider')]
    public function ひらがな1文字がカタカナ1文字に変換される(string $hira, string $kata): void
    {
        $this->assertSame($kata, KanaConverter::toKatakana($hira));
    }

    public static function hiraganaToKatakanaProvider(): array
    {
        return [
            // ア行
            'あ' => ['あ', 'ア'], 'い' => ['い', 'イ'], 'う' => ['う', 'ウ'],
            'え' => ['え', 'エ'], 'お' => ['お', 'オ'],
            // カ行
            'か' => ['か', 'カ'], 'き' => ['き', 'キ'], 'く' => ['く', 'ク'],
            'け' => ['け', 'ケ'], 'こ' => ['こ', 'コ'],
            // サ行
            'さ' => ['さ', 'サ'], 'し' => ['し', 'シ'], 'す' => ['す', 'ス'],
            'せ' => ['せ', 'セ'], 'そ' => ['そ', 'ソ'],
            // タ行
            'た' => ['た', 'タ'], 'ち' => ['ち', 'チ'], 'つ' => ['つ', 'ツ'],
            'て' => ['て', 'テ'], 'と' => ['と', 'ト'],
            // ナ行
            'な' => ['な', 'ナ'], 'に' => ['に', 'ニ'], 'ぬ' => ['ぬ', 'ヌ'],
            'ね' => ['ね', 'ネ'], 'の' => ['の', 'ノ'],
            // ハ行
            'は' => ['は', 'ハ'], 'ひ' => ['ひ', 'ヒ'], 'ふ' => ['ふ', 'フ'],
            'へ' => ['へ', 'ヘ'], 'ほ' => ['ほ', 'ホ'],
            // マ行
            'ま' => ['ま', 'マ'], 'み' => ['み', 'ミ'], 'む' => ['む', 'ム'],
            'め' => ['め', 'メ'], 'も' => ['も', 'モ'],
            // ヤ行
            'や' => ['や', 'ヤ'], 'ゆ' => ['ゆ', 'ユ'], 'よ' => ['よ', 'ヨ'],
            // ラ行
            'ら' => ['ら', 'ラ'], 'り' => ['り', 'リ'], 'る' => ['る', 'ル'],
            'れ' => ['れ', 'レ'], 'ろ' => ['ろ', 'ロ'],
            // ワ行
            'わ' => ['わ', 'ワ'], 'を' => ['を', 'ヲ'], 'ん' => ['ん', 'ン'],
            // 濁音（カ行）
            'が' => ['が', 'ガ'], 'ぎ' => ['ぎ', 'ギ'], 'ぐ' => ['ぐ', 'グ'],
            'げ' => ['げ', 'ゲ'], 'ご' => ['ご', 'ゴ'],
            // 濁音（サ行）
            'ざ' => ['ざ', 'ザ'], 'じ' => ['じ', 'ジ'], 'ず' => ['ず', 'ズ'],
            'ぜ' => ['ぜ', 'ゼ'], 'ぞ' => ['ぞ', 'ゾ'],
            // 濁音（タ行）
            'だ' => ['だ', 'ダ'], 'ぢ' => ['ぢ', 'ヂ'], 'づ' => ['づ', 'ヅ'],
            'で' => ['で', 'デ'], 'ど' => ['ど', 'ド'],
            // 濁音（ハ行）
            'ば' => ['ば', 'バ'], 'び' => ['び', 'ビ'], 'ぶ' => ['ぶ', 'ブ'],
            'べ' => ['べ', 'ベ'], 'ぼ' => ['ぼ', 'ボ'],
            // 半濁音
            'ぱ' => ['ぱ', 'パ'], 'ぴ' => ['ぴ', 'ピ'], 'ぷ' => ['ぷ', 'プ'],
            'ぺ' => ['ぺ', 'ペ'], 'ぽ' => ['ぽ', 'ポ'],
            // 小文字
            'ぁ' => ['ぁ', 'ァ'], 'ぃ' => ['ぃ', 'ィ'], 'ぅ' => ['ぅ', 'ゥ'],
            'ぇ' => ['ぇ', 'ェ'], 'ぉ' => ['ぉ', 'ォ'],
            'ゃ' => ['ゃ', 'ャ'], 'ゅ' => ['ゅ', 'ュ'], 'ょ' => ['ょ', 'ョ'],
            'っ' => ['っ', 'ッ'],
            // mb_convert_kana で変換されないため strtr で補完する文字
            'ゔ' => ['ゔ', 'ヴ'],
            'ゕ' => ['ゕ', 'ヵ'],
            'ゖ' => ['ゖ', 'ヶ'],
        ];
    }

    // =========================================================================
    // toKatakana: 半角カナ → 全角カタカナ（全文字）
    // =========================================================================

    #[Test]
    #[DataProvider('halfKanaToKatakanaProvider')]
    public function 半角カナ1文字が全角カタカナ1文字に変換される(string $half, string $kata): void
    {
        $this->assertSame($kata, KanaConverter::toKatakana($half));
    }

    public static function halfKanaToKatakanaProvider(): array
    {
        return [
            'ｱ' => ['ｱ', 'ア'], 'ｲ' => ['ｲ', 'イ'], 'ｳ' => ['ｳ', 'ウ'],
            'ｴ' => ['ｴ', 'エ'], 'ｵ' => ['ｵ', 'オ'],
            'ｶ' => ['ｶ', 'カ'], 'ｷ' => ['ｷ', 'キ'], 'ｸ' => ['ｸ', 'ク'],
            'ｹ' => ['ｹ', 'ケ'], 'ｺ' => ['ｺ', 'コ'],
            'ｻ' => ['ｻ', 'サ'], 'ｼ' => ['ｼ', 'シ'], 'ｽ' => ['ｽ', 'ス'],
            'ｾ' => ['ｾ', 'セ'], 'ｿ' => ['ｿ', 'ソ'],
            'ﾀ' => ['ﾀ', 'タ'], 'ﾁ' => ['ﾁ', 'チ'], 'ﾂ' => ['ﾂ', 'ツ'],
            'ﾃ' => ['ﾃ', 'テ'], 'ﾄ' => ['ﾄ', 'ト'],
            'ﾅ' => ['ﾅ', 'ナ'], 'ﾆ' => ['ﾆ', 'ニ'], 'ﾇ' => ['ﾇ', 'ヌ'],
            'ﾈ' => ['ﾈ', 'ネ'], 'ﾉ' => ['ﾉ', 'ノ'],
            'ﾊ' => ['ﾊ', 'ハ'], 'ﾋ' => ['ﾋ', 'ヒ'], 'ﾌ' => ['ﾌ', 'フ'],
            'ﾍ' => ['ﾍ', 'ヘ'], 'ﾎ' => ['ﾎ', 'ホ'],
            'ﾏ' => ['ﾏ', 'マ'], 'ﾐ' => ['ﾐ', 'ミ'], 'ﾑ' => ['ﾑ', 'ム'],
            'ﾒ' => ['ﾒ', 'メ'], 'ﾓ' => ['ﾓ', 'モ'],
            'ﾔ' => ['ﾔ', 'ヤ'], 'ﾕ' => ['ﾕ', 'ユ'], 'ﾖ' => ['ﾖ', 'ヨ'],
            'ﾗ' => ['ﾗ', 'ラ'], 'ﾘ' => ['ﾘ', 'リ'], 'ﾙ' => ['ﾙ', 'ル'],
            'ﾚ' => ['ﾚ', 'レ'], 'ﾛ' => ['ﾛ', 'ロ'],
            'ﾜ' => ['ﾜ', 'ワ'], 'ｦ' => ['ｦ', 'ヲ'], 'ﾝ' => ['ﾝ', 'ン'],
            // 濁音（2文字 → 1文字）
            'ｶﾞ' => ['ｶﾞ', 'ガ'], 'ｷﾞ' => ['ｷﾞ', 'ギ'], 'ｸﾞ' => ['ｸﾞ', 'グ'],
            'ｹﾞ' => ['ｹﾞ', 'ゲ'], 'ｺﾞ' => ['ｺﾞ', 'ゴ'],
            'ｻﾞ' => ['ｻﾞ', 'ザ'], 'ｼﾞ' => ['ｼﾞ', 'ジ'], 'ｽﾞ' => ['ｽﾞ', 'ズ'],
            'ｾﾞ' => ['ｾﾞ', 'ゼ'], 'ｿﾞ' => ['ｿﾞ', 'ゾ'],
            'ﾀﾞ' => ['ﾀﾞ', 'ダ'], 'ﾁﾞ' => ['ﾁﾞ', 'ヂ'], 'ﾂﾞ' => ['ﾂﾞ', 'ヅ'],
            'ﾃﾞ' => ['ﾃﾞ', 'デ'], 'ﾄﾞ' => ['ﾄﾞ', 'ド'],
            'ﾊﾞ' => ['ﾊﾞ', 'バ'], 'ﾋﾞ' => ['ﾋﾞ', 'ビ'], 'ﾌﾞ' => ['ﾌﾞ', 'ブ'],
            'ﾍﾞ' => ['ﾍﾞ', 'ベ'], 'ﾎﾞ' => ['ﾎﾞ', 'ボ'],
            // 半濁音（2文字 → 1文字）
            'ﾊﾟ' => ['ﾊﾟ', 'パ'], 'ﾋﾟ' => ['ﾋﾟ', 'ピ'], 'ﾌﾟ' => ['ﾌﾟ', 'プ'],
            'ﾍﾟ' => ['ﾍﾟ', 'ペ'], 'ﾎﾟ' => ['ﾎﾟ', 'ポ'],
            // 小文字
            'ｧ' => ['ｧ', 'ァ'], 'ｨ' => ['ｨ', 'ィ'], 'ｩ' => ['ｩ', 'ゥ'],
            'ｪ' => ['ｪ', 'ェ'], 'ｫ' => ['ｫ', 'ォ'],
            'ｬ' => ['ｬ', 'ャ'], 'ｭ' => ['ｭ', 'ュ'], 'ｮ' => ['ｮ', 'ョ'],
            'ｯ' => ['ｯ', 'ッ'],
            // 長音
            'ｰ' => ['ｰ', 'ー'],
        ];
    }

    // =========================================================================
    // 非カナ文字は変換されない
    // =========================================================================

    #[Test]
    public function ひらがなはtoHiraganaでそのまま返る(): void
    {
        $input = 'あいうえお';
        $this->assertSame($input, KanaConverter::toHiragana($input));
    }

    #[Test]
    public function 全角カタカナはtoKatakanaでそのまま返る(): void
    {
        $input = 'アイウエオ';
        $this->assertSame($input, KanaConverter::toKatakana($input));
    }

    #[Test]
    public function 漢字や英数字は変換されない(): void
    {
        $input = '日本語ABC123';
        $this->assertSame($input, KanaConverter::toHiragana($input));
        $this->assertSame($input, KanaConverter::toKatakana($input));
    }

    // =========================================================================
    // エッジケース
    // =========================================================================

    #[Test]
    public function 空文字列はそのまま返す(): void
    {
        $this->assertSame('', KanaConverter::toHiragana(''));
        $this->assertSame('', KanaConverter::toKatakana(''));
    }

    #[Test]
    public function 混在文字列を正しく変換する(): void
    {
        $this->assertSame('あいう日本語abc', KanaConverter::toHiragana('アイウ日本語abc'));
        $this->assertSame('アイウ日本語abc', KanaConverter::toKatakana('あいう日本語abc'));
    }

    #[Test]
    public function 半角カナ混在文字列をひらがなに変換する(): void
    {
        $this->assertSame('がいどの名前はたなかです', KanaConverter::toHiragana('ｶﾞｲﾄﾞの名前はﾀﾅｶです'));
    }

    #[Test]
    public function 半角カナ混在文字列をカタカナに変換する(): void
    {
        // ひらがな「の・は・で・す」もカタカナに変換される
        $this->assertSame('ガイドノ名前ハタナカデス', KanaConverter::toKatakana('ｶﾞｲﾄﾞの名前はﾀﾅｶです'));
    }
}
